# Human-in-the-Loop Intro

Демонстрационный проект о паттернах Human-in-the-Loop (HITL) для LLM/агентов: прерывания, точки остановки, валидационные циклы, редактирование графа выполнения, потоковая выдача и «перемотка времени». Скрипты — небольшие, изолированные примеры, которые можно запускать по одному.

Дата: 2025‑11‑11

## Быстрый старт

1. Требования
   - Python 3.10+ (рекомендуется 3.11 или новее)
   - Действующие API‑ключи для используемых сервисов (OpenRouter, LangSmith)

2. Клонирование и установка
   ```bash
   # переход в нужную папку и установка зависимостей
   pip install -r requirements.txt
   ```

3. Настройка переменных окружения
   - Скопируйте пример файла окружения и заполните значения:
     ```bash
     cp .env.example .env
     ```
   - В файле `.env` укажите ключи и параметры. Переменные читаются через Pydantic Settings из `config.py`:
     - `LANGSMITH_TRACING` — вкл/выкл трассировку LangSmith (например, `true`/`false`).
     - `LANGSMITH_ENDPOINT` — адрес эндпоинта LangSmith.
     - `LANGSMITH_API_KEY` — API‑ключ LangSmith.
     - `LANGSMITH_PROJECT` — имя проекта/трассы в LangSmith.
     - `OPENROUTER_API_KEY` — API‑ключ OpenRouter для вызовов LLM.

4. Запуск любого примера
   ```bash
   # общий шаблон
   python <относительный_путь_к_скрипту>.py

   # примеры
   python streaming_intro/values_intro.py
   python breakpoints_intro/graph.py
   python time_travel/time_travel_demo.py
   ```

Если при первом запуске что‑то не работает, проверьте, что `.env` заполнен, и что доступ в интернет открыт для соответствующих сервисов.

## Структура проекта

- `config.py` — загрузка настроек из `.env` c помощью `pydantic-settings`.
- `setup_llm.py` — инициализация клиента/модели LLM (использует ключи из окружения).
- `requirements.txt` — зависимости проекта.
- `.env.example` — пример значений переменных окружения.

Директории с примерами:

- `streaming_intro/`
  - `messages_intro.py` — базовые приёмы потоковой передачи сообщений/контента.
  - `values_intro.py` — потоковые обновления значений (state/value streaming) при выполнении.
  - `custom_intro.py` — пользовательские обработчики/каналы для стриминга.
  - `debug_intro.py` — наблюдение и отладка потоковой выдачи.
  - `graph_example.py` — демонстрация стриминга внутри графа выполнения.
  - `updates_intro.py` — подписки на обновления и инкрементальные события.

- `breakpoints_intro/`
  - `graph.py` — точки остановки (breakpoints) в графе: пауза выполнения, осмотр состояния, продолжение с участием человека.

- `interrupt_intro/`
  - `simple_approve_1.py` — простое «принять/отклонить» с человеческим подтверждением.
  - `review_and_edit_intro_2.py` — человек просматривает и правит результаты перед продолжением.
  - `interrupt_tools_3.py` — прерывания при вызовах инструментов или шагов агента.
  - `validation_loop_4.py` — петля валидации: автоматический шаг → проверка человеком → повтор.
  - `multiple_interrupts_5.py` — несколько прерываний на разных этапах.

- `edit_graph_intro/`
  - `edit_intro.py` — интерактивное редактирование/перезапуск частей графа выполнения.
  - `react_graph.py` — пример графа в стиле ReAct с возможностью правок по ходу.

- `time_travel/`
  - `time_travel_demo.py` — «перемотка времени»: возврат к предыдущему состоянию и повтор шага.

Примечание: названия файлов отражают идею примеров. Конкретные детали можно посмотреть внутри каждого скрипта.

## Как это работает (в общих чертах)

- Конфигурация загружается из `.env` при импорте `config.py` (класс `Settings`).
- Инициализация LLM и вспомогательных клиентов выполняется в `setup_llm.py`.
- Каждый скрипт — самостоятельная мини‑демонстрация определённого HITL‑паттерна. Обычно их можно запускать независимо.

## Советы по работе

- Безопасность ключей: не коммитьте `.env` в репозиторий (см. `.gitignore`).
- Стоимость и квоты: работа через OpenRouter/LangSmith может тарифицироваться — следите за лимитами.
- Логи и трассировка: включите `LANGSMITH_TRACING=true` и задайте корректные `LANGSMITH_*`, чтобы видеть шаги выполнения в LangSmith.

## Типичные проблемы

- «Missing API key»/401 — проверьте `OPENROUTER_API_KEY` или `LANGSMITH_API_KEY`.
- «Connection error» — проверьте сеть и `LANGSMITH_ENDPOINT`.
- Ошибки совместимости Python — используйте актуальную версию 3.11+ и переустановите зависимости.

## Разработка

Рекомендуемый рабочий цикл:

1. Создать/активировать виртуальное окружение.
2. Установить зависимости из `requirements.txt`.
3. Настроить `.env`.
4. Запускать интересующие скрипты по одному, внося изменения и наблюдая поведение.